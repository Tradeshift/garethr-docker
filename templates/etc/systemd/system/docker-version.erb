#!/bin/sh

image_name="<%= @image_name %>"
image_version="<%= @image_version %>"
component_etc_dir="/etc/tradeshift/<%= @sanitised_title %>"
version_override_file="${component_etc_dir}/VERSION_OVERRIDE"
systemctl_bin="$(which systemctl)"

if [ -r $version_override_file ]
 then
  . $version_override_file
  [ -n "$VERSION" ] && image_version="${VERSION}"
fi

if [ -n "${image_version}" ]
 then
  $systemctl_bin set-environment image="${image_name}:${image_version}"
else
  $systemctl_bin set-environment image="${image_name}"
fi
